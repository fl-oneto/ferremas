{% extends 'base.html' %}
{% load static %}
{% block title %}Formulario de Producto{% endblock %} 
{% block content %}
<div class="container my-4">
    <h2 class="mb-4">Formulario de Producto</h2>
    {% if messages %}
    <div class="container mt-3">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <div class="mb-3">
        {{ form.nombre.label_tag }} {{ form.nombre }}
    </div>

    <div class="mb-3">
        {{ form.descripcion.label_tag }} {{ form.descripcion }}
    </div>

    <div class="mb-3">
        {{ form.stock.label_tag }} {{ form.stock }}
    </div>

    <div class="mb-3">
        {{ form.precio_venta.label_tag }} {{ form.precio_venta }}
    </div>

    <div class="mb-3">
        {{ form.precio_compra.label_tag }} {{ form.precio_compra }}
    </div>

    <div class="mb-3">
            {{ form.categoria.label_tag }}
            <select name="categoria" class="form-select" id="id_categoria">
                {% for cat in form.fields.categoria.queryset %}
                    <option value="{{ cat.id }}">{{ cat.nombre }}</option>
                {% endfor %}
                <option value="" disabled>────────────</option>
                <option value="nueva">Agregar nueva categoría</option>
            </select>
        </div>

    <div class="mb-3" id="nueva-categoria-campo" style="display: none;">
        {{ form.nueva_categoria.label_tag }} {{ form.nueva_categoria }}
    </div>


    <div class="mb-3">
        {{ form.unidad_medida.label_tag }} {{ form.unidad_medida }}
    </div>

    <div class="mb-3">
        {{ form.imagen.label_tag }} {{ form.imagen }}
    </div>

    <button type="submit" class="btn btn-success">Guardar</button>
    <a href="{% url 'dashboard_admin' %}" class="btn btn-secondary">Volver</a>
</form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const select = document.getElementById('id_categoria');
        const campoNueva = document.getElementById('campo-nueva-categoria');

        function toggleNuevaCategoria() {
            console.log('Valor select:', select.value);  
            if (select.value === 'nueva') {
                campoNueva.style.display = 'block';
            } else {
                campoNueva.style.display = 'none';
            }
        }

        select.addEventListener('change', toggleNuevaCategoria);
        toggleNuevaCategoria(); 
    });
</script>
{% endblock %}
